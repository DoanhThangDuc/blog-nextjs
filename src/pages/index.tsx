import { observer } from "mobx-react-lite";
import { NextPage } from "next";
import Head from "next/head";
import React from "react";

import Home from "@/components/Home/Home";
import { IServerRenderProps } from "@/shared/types";
import { HomeData, HomeStore } from "@/stores/HomeStore";

export type IHomeProps =
  | ({
    pageData: HomeData;
  } & IServerRenderProps);

const IndexPage: NextPage<IHomeProps> = observer<IHomeProps>((props) => {
  const { pageData } = props;
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>
        <Home posts={pageData.posts} status="idle" errorMessage="" />
      </div>
    </>
  );
});

export async function getServerSideProps(ctx: any) {
  const pageStore = new HomeStore();
  await pageStore.fetchPosts();

  return {
    props: {
      pageData: pageStore.dehydrate(),
      isServerRender: true,
    },
  };
}
export default IndexPage;
